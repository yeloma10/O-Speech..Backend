"""Check if a host is in the Google Chrome HSTS Preload list"""

import functools
import os
import typing

__version__ = "2024.11.1"
__checksum__ = "4b0cc2ff0a18bfe039e5b9271516998a87d656e008458a52f0b1e5d06d4844b9"
__all__ = ["in_hsts_preload"]

# fmt: off
_GTLD_INCLUDE_SUBDOMAINS = {b'amazon', b'android', b'app', b'audible', b'azure', b'bank', b'bing', b'boo', b'channel', b'chrome', b'dad', b'day', b'dev', b'eat', b'esq', b'fire', b'fly', b'foo', b'fujitsu', b'gle', b'gmail', b'google', b'hangout', b'hotmail', b'imdb', b'ing', b'insurance', b'kindle', b'meet', b'meme', b'microsoft', b'mov', b'new', b'nexus', b'office', b'page', b'phd', b'play', b'prime', b'prof', b'rsvp', b'search', b'silk', b'skype', b'windows', b'xbox', b'xn--cckwcxetd', b'xn--jlq480n2rg', b'youtube', b'zappos', b'zip'}  # noqa: E501
_JUMPTABLE = [[(0, 11), (11, 5), (16, 19), (35, 55), (90, 26), (116, 12), (128, 8), (136, 19), (155, 22), (177, 7), (184, 20), (204, 18), None, (222, 29), (251, 37), (288, 19), (307, 9), (316, 36), (352, 24), (376, 10), (386, 18), None, (404, 62), (466, 8), (474, 22), (496, 19), (515, 13), (528, 14), (542, 21), None, None, (563, 40), (603, 20), (623, 25), (648, 22), (670, 22), (692, 28), None, (720, 15), (735, 25), (760, 8), (768, 13), (781, 10), None, (791, 17), (808, 6), (814, 19), (833, 16), (849, 5), (854, 19), (873, 14), (887, 11), (898, 18), (916, 27), (943, 7), (950, 11), (961, 15), (976, 12), (988, 20), (1008, 8), (1016, 27), (1043, 46), (1089, 25), (1114, 16), (1130, 8), (1138, 5), (1143, 22), (1165, 18), None, (1183, 36), (1219, 15), (1234, 24), (1258, 11), None, (1269, 10), (1279, 23), (1302, 18), (1320, 18), None, (1338, 20), (1358, 26), (1384, 27), (1411, 28), (1439, 20), (1459, 59), (1518, 21), (1539, 14), (1553, 8), (1561, 8), (1569, 10), (1579, 13), (1592, 20), (1612, 19), None, (1631, 13), (1644, 26), (1670, 11), (1681, 4), (1685, 22), (1707, 19), (1726, 21), (1747, 14), (1761, 28), (1789, 11), (1800, 10), (1810, 12), (1822, 25), None, (1847, 19), (1866, 14), (1880, 26), (1906, 45), (1951, 15), None, (1966, 11), (1977, 30), (2007, 21), (2028, 26), (2054, 6), (2060, 6), (2066, 14), (2080, 5), (2085, 30), (2115, 23), (2138, 6), (2144, 17), (2161, 8), (2169, 12), (2181, 12), (2193, 70), (2263, 55), (2318, 12), (2330, 23), (2353, 16), (2369, 29), (2398, 9), (2407, 24), (2431, 44), (2475, 6), (2481, 41), (2522, 22), (2544, 23), (2567, 31), (2598, 20), (2618, 8), (2626, 15), (2641, 12), (2653, 32), (2685, 25), (2710, 15), None, (2725, 46), (2771, 21), (2792, 17), (2809, 14), (2823, 26), (2849, 5), (2854, 37), (2891, 39), (2930, 16), (2946, 33), (2979, 17), (2996, 23), (3019, 21), (3040, 25), (3065, 19), (3084, 14), (3098, 7), (3105, 37), None, (3142, 18), (3160, 21), (3181, 20), (3201, 17), (3218, 24), (3242, 12), (3254, 36), (3290, 35), (3325, 12), (3337, 57), (3394, 25), (3419, 32), None, (3451, 8), (3459, 25), (3484, 18), (3502, 6), (3508, 23), None, (3531, 36), (3567, 33), (3600, 14), (3614, 16), (3630, 22), None, (3652, 30), (3682, 41), (3723, 50), (3773, 15), (3788, 20), (3808, 31), (3839, 21), (3860, 32), (3892, 24), (3916, 20), (3936, 17), (3953, 60), (4013, 6), (4019, 9), (4028, 12), (4040, 18), (4058, 11), (4069, 10), (4079, 39), (4118, 42), None, (4160, 36), (4196, 17), None, (4213, 8), (4221, 8), (4229, 17), None, (4246, 25), (4271, 17), None, (4288, 21), (4309, 35), (4344, 21), (4365, 10), (4375, 48), (4423, 11), (4434, 37), (4471, 41), (4512, 19), (4531, 12), (4543, 14), (4557, 23), (4580, 29), (4609, 14), (4623, 8), (4631, 47), (4678, 52), None, None, (4730, 47), (4777, 42), None, (4819, 18), None, (4837, 20), (4857, 8), (4865, 21), (4886, 6), (4892, 29), (4921, 22)], [(4943, 8912), (13855, 8401), (22256, 9025), (31281, 8854), (40135, 8376), (48511, 8828), (57339, 9136), (66475, 8379), (74854, 8535), (83389, 8175), (91564, 8805), (100369, 8060), (108429, 8546), (116975, 9395), (126370, 8612), (134982, 9479), (144461, 9468), (153929, 8167), (162096, 8853), (170949, 8027), (178976, 8988), (187964, 8331), (196295, 8621), (204916, 9172), (214088, 8980), (223068, 8440), (231508, 9094), (240602, 9766), (250368, 8396), (258764, 8292), (267056, 9108), (276164, 8707), (284871, 8787), (293658, 8968), (302626, 8411), (311037, 9141), (320178, 8953), (329131, 9559), (338690, 9220), (347910, 9013), (356923, 9137), (366060, 8005), (374065, 8633), (382698, 8556), (391254, 8337), (399591, 8814), (408405, 8350), (416755, 10001), (426756, 8418), (435174, 8145), (443319, 8674), (451993, 8345), (460338, 8619), (468957, 8766), (477723, 8309), (486032, 8751), (494783, 8659), (503442, 8956), (512398, 8780), (521178, 7683), (528861, 8111), (536972, 9009), (545981, 8917), (554898, 9174), (564072, 9691), (573763, 8397), (582160, 8702), (590862, 9240), (600102, 9502), (609604, 8519), (618123, 8152), (626275, 8274), (634549, 8029), (642578, 9109), (651687, 8410), (660097, 9073), (669170, 8271), (677441, 9712), (687153, 8782), (695935, 8523), (704458, 8675), (713133, 7967), (721100, 8464), (729564, 8861), (738425, 8781), (747206, 9084), (756290, 9349), (765639, 8558), (774197, 7911), (782108, 8754), (790862, 9955), (800817, 8789), (809606, 8297), (817903, 8672), (826575, 8712), (835287, 8574), (843861, 8811), (852672, 8126), (860798, 8826), (869624, 7935), (877559, 8519), (886078, 8169), (894247, 8686), (902933, 8190), (911123, 8379), (919502, 9449), (928951, 8883), (937834, 9215), (947049, 8278), (955327, 8397), (963724, 9433), (973157, 8822), (981979, 8008), (989987, 8108), (998095, 8585), (1006680, 8541), (1015221, 8866), (1024087, 9028), (1033115, 8744), (1041859, 8616), (1050475, 8896), (1059371, 8753), (1068124, 8381), (1076505, 8691), (1085196, 9175), (1094371, 8267), (1102638, 8590), (1111228, 9415), (1120643, 8378), (1129021, 9869), (1138890, 9594), (1148484, 8735), (1157219, 8257), (1165476, 7930), (1173406, 8215), (1181621, 9399), (1191020, 9436), (1200456, 9749), (1210205, 8964), (1219169, 9162), (1228331, 9530), (1237861, 9046), (1246907, 8662), (1255569, 8893), (1264462, 9756), (1274218, 7667), (1281885, 8917), (1290802, 8648), (1299450, 8630), (1308080, 8668), (1316748, 8672), (1325420, 8789), (1334209, 8678), (1342887, 8234), (1351121, 8377), (1359498, 8916), (1368414, 8869), (1377283, 8762), (1386045, 8264), (1394309, 8202), (1402511, 8346), (1410857, 8680), (1419537, 8804), (1428341, 8520), (1436861, 8781), (1445642, 9578), (1455220, 9727), (1464947, 8153), (1473100, 9827), (1482927, 8726), (1491653, 8661), (1500314, 8585), (1508899, 9332), (1518231, 8330), (1526561, 8322), (1534883, 8562), (1543445, 9140), (1552585, 9134), (1561719, 8443), (1570162, 8070), (1578232, 10883), (1589115, 9415), (1598530, 8124), (1606654, 8480), (1615134, 8889), (1624023, 9099), (1633122, 8001), (1641123, 9486), (1650609, 8506), (1659115, 8787), (1667902, 8701), (1676603, 8420), (1685023, 8632), (1693655, 7913), (1701568, 8599), (1710167, 8052), (1718219, 7880), (1726099, 8297), (1734396, 8674), (1743070, 9156), (1752226, 8874), (1761100, 8907), (1770007, 9068), (1779075, 7832), (1786907, 9116), (1796023, 9237), (1805260, 8184), (1813444, 8878), (1822322, 9799), (1832121, 8243), (1840364, 9534), (1849898, 8889), (1858787, 8371), (1867158, 8588), (1875746, 8857), (1884603, 8822), (1893425, 8388), (1901813, 8684), (1910497, 8531), (1919028, 9402), (1928430, 8607), (1937037, 8049), (1945086, 9114), (1954200, 8677), (1962877, 8868), (1971745, 8488), (1980233, 9596), (1989829, 9190), (1999019, 9000), (2008019, 9353), (2017372, 9351), (2026723, 8707), (2035430, 8527), (2043957, 9150), (2053107, 8465), (2061572, 9521), (2071093, 8595), (2079688, 8076), (2087764, 7941), (2095705, 9165), (2104870, 9352), (2114222, 9007), (2123229, 8960), (2132189, 9009), (2141198, 8443), (2149641, 9484), (2159125, 8952), (2168077, 8541), (2176618, 8827), (2185445, 7989), (2193434, 8653), (2202087, 8770), (2210857, 8392), (2219249, 8254), (2227503, 8583), (2236086, 8922)], [(2245008, 948), (2245956, 829), (2246785, 905), (2247690, 857), (2248547, 923), (2249470, 825), (2250295, 651), (2250946, 955), (2251901, 685), (2252586, 940), (2253526, 476), (2254002, 755), (2254757, 944), (2255701, 1013), (2256714, 847), (2257561, 753), (2258314, 1306), (2259620, 800), (2260420, 814), (2261234, 848), (2262082, 1198), (2263280, 764), (2264044, 778), (2264822, 740), (2265562, 809), (2266371, 795), (2267166, 932), (2268098, 1371), (2269469, 829), (2270298, 777), (2271075, 811), (2271886, 767), (2272653, 754), (2273407, 812), (2274219, 1056), (2275275, 1100), (2276375, 583), (2276958, 910), (2277868, 779), (2278647, 1035), (2279682, 843), (2280525, 804), (2281329, 723), (2282052, 858), (2282910, 852), (2283762, 839), (2284601, 774), (2285375, 868), (2286243, 841), (2287084, 600), (2287684, 780), (2288464, 801), (2289265, 837), (2290102, 892), (2290994, 1427), (2292421, 692), (2293113, 880), (2293993, 770), (2294763, 644), (2295407, 791), (2296198, 896), (2297094, 838), (2297932, 1050), (2298982, 863), (2299845, 877), (2300722, 810), (2301532, 992), (2302524, 715), (2303239, 591), (2303830, 1082), (2304912, 888), (2305800, 757), (2306557, 450), (2307007, 843), (2307850, 431), (2308281, 804), (2309085, 656), (2309741, 990), (2310731, 918), (2311649, 631), (2312280, 910), (2313190, 831), (2314021, 956), (2314977, 787), (2315764, 1029), (2316793, 939), (2317732, 772), (2318504, 608), (2319112, 934), (2320046, 944), (2320990, 1152), (2322142, 1157), (2323299, 972), (2324271, 794), (2325065, 728), (2325793, 638), (2326431, 1015), (2327446, 845), (2328291, 774), (2329065, 767), (2329832, 841), (2330673, 817), (2331490, 816), (2332306, 624), (2332930, 830), (2333760, 952), (2334712, 673), (2335385, 594), (2335979, 882), (2336861, 1025), (2337886, 853), (2338739, 1030), (2339769, 1092), (2340861, 767), (2341628, 715), (2342343, 749), (2343092, 778), (2343870, 905), (2344775, 676), (2345451, 771), (2346222, 1106), (2347328, 782), (2348110, 950), (2349060, 839), (2349899, 920), (2350819, 872), (2351691, 876), (2352567, 907), (2353474, 637), (2354111, 981), (2355092, 799), (2355891, 1013), (2356904, 758), (2357662, 683), (2358345, 666), (2359011, 964), (2359975, 958), (2360933, 724), (2361657, 656), (2362313, 924), (2363237, 838), (2364075, 716), (2364791, 748), (2365539, 697), (2366236, 801), (2367037, 659), (2367696, 842), (2368538, 669), (2369207, 867), (2370074, 745), (2370819, 862), (2371681, 693), (2372374, 825), (2373199, 947), (2374146, 1074), (2375220, 885), (2376105, 822), (2376927, 1057), (2377984, 907), (2378891, 785), (2379676, 1098), (2380774, 719), (2381493, 964), (2382457, 958), (2383415, 1097), (2384512, 1129), (2385641, 686), (2386327, 970), (2387297, 746), (2388043, 719), (2388762, 884), (2389646, 540), (2390186, 1213), (2391399, 677), (2392076, 1035), (2393111, 868), (2393979, 1050), (2395029, 840), (2395869, 645), (2396514, 790), (2397304, 2052), (2399356, 873), (2400229, 906), (2401135, 829), (2401964, 1093), (2403057, 652), (2403709, 932), (2404641, 953), (2405594, 614), (2406208, 1060), (2407268, 644), (2407912, 630), (2408542, 562), (2409104, 1231), (2410335, 802), (2411137, 754), (2411891, 758), (2412649, 713), (2413362, 1000), (2414362, 964), (2415326, 894), (2416220, 852), (2417072, 953), (2418025, 742), (2418767, 739), (2419506, 752), (2420258, 764), (2421022, 1051), (2422073, 1008), (2423081, 824), (2423905, 856), (2424761, 743), (2425504, 871), (2426375, 1150), (2427525, 573), (2428098, 830), (2428928, 798), (2429726, 827), (2430553, 742), (2431295, 646), (2431941, 675), (2432616, 884), (2433500, 898), (2434398, 1029), (2435427, 580), (2436007, 732), (2436739, 769), (2437508, 838), (2438346, 856), (2439202, 821), (2440023, 1017), (2441040, 606), (2441646, 1081), (2442727, 697), (2443424, 748), (2444172, 824), (2444996, 909), (2445905, 697), (2446602, 942), (2447544, 970), (2448514, 860), (2449374, 550), (2449924, 906), (2450830, 697), (2451527, 993), (2452520, 576), (2453096, 806), (2453902, 926), (2454828, 740), (2455568, 951), (2456519, 2389), (2458908, 734), (2459642, 940), (2460582, 816), (2461398, 910), (2462308, 744)], [(2463052, 48), None, None, (2463100, 42), None, (2463142, 27), (2463169, 43), None, None, None, None, None, None, None, (2463212, 21), None, None, (2463233, 42), (2463275, 20), (2463295, 25), (2463320, 44), None, (2463364, 64), (2463428, 18), None, (2463446, 23), None, None, None, None, None, None, (2463469, 21), (2463490, 46), None, None, (2463536, 44), None, None, None, None, (2463580, 44), (2463624, 42), (2463666, 23), None, None, None, None, (2463689, 42), None, None, None, None, None, (2463731, 31), None, None, None, None, (2463762, 42), (2463804, 19), None, None, (2463823, 21), None, (2463844, 26), (2463870, 56), None, (2463926, 16), (2463942, 42), (2463984, 27), None, None, None, None, (2464011, 21), (2464032, 52), None, (2464084, 17), (2464101, 20), (2464121, 42), None, None, None, (2464163, 40), (2464203, 17), (2464220, 27), (2464247, 21), None, None, None, (2464268, 24), None, (2464292, 24), (2464316, 21), (2464337, 24), None, (2464361, 48), None, None, (2464409, 17), (2464426, 19), None, None, None, None, (2464445, 31), None, None, None, None, None, None, (2464476, 28), None, (2464504, 42), (2464546, 42), (2464588, 17), (2464605, 17), (2464622, 26), (2464648, 17), (2464665, 19), None, None, None, None, (2464684, 20), None, None, (2464704, 42), (2464746, 63), (2464809, 17), None, None, (2464826, 21), None, None, None, None, (2464847, 21), (2464868, 16), None, (2464884, 31), None, None, None, None, (2464915, 42), None, (2464957, 80), None, (2465037, 9), None, (2465046, 21), (2465067, 42), None, (2465109, 18), (2465127, 90), (2465217, 56), (2465273, 45), None, (2465318, 42), None, None, (2465360, 24), (2465384, 21), None, None, None, None, None, (2465405, 42), (2465447, 21), (2465468, 21), None, (2465489, 42), (2465531, 25), None, (2465556, 55), (2465611, 21), (2465632, 42), None, None, (2465674, 36), (2465710, 16), None, None, (2465726, 16), None, (2465742, 35), None, None, (2465777, 21), None, (2465798, 22), (2465820, 21), (2465841, 21), (2465862, 21), None, (2465883, 63), (2465946, 41), (2465987, 39), (2466026, 42), None, None, None, None, None, (2466068, 15), (2466083, 21), (2466104, 21), None, None, (2466125, 21), None, (2466146, 23), (2466169, 21), None, None, (2466190, 19), (2466209, 66), None, None, None, (2466275, 50), None, (2466325, 21), (2466346, 21), (2466367, 19), None, (2466386, 16), (2466402, 26), None, (2466428, 58), (2466486, 42), None, None, None, None, None, None, (2466528, 21), None, None, None, (2466549, 21), None, None, (2466570, 64), None, (2466634, 254), (2466888, 21), (2466909, 24), None, (2466933, 21), (2466954, 29)], [None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, (2466983, 62), None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None]]  # noqa: E501
_CRC8_TABLE = [
    0x00, 0x07, 0x0e, 0x09, 0x1c, 0x1b, 0x12, 0x15,
    0x38, 0x3f, 0x36, 0x31, 0x24, 0x23, 0x2a, 0x2d,
    0x70, 0x77, 0x7e, 0x79, 0x6c, 0x6b, 0x62, 0x65,
    0x48, 0x4f, 0x46, 0x41, 0x54, 0x53, 0x5a, 0x5d,
    0xe0, 0xe7, 0xee, 0xe9, 0xfc, 0xfb, 0xf2, 0xf5,
    0xd8, 0xdf, 0xd6, 0xd1, 0xc4, 0xc3, 0xca, 0xcd,
    0x90, 0x97, 0x9e, 0x99, 0x8c, 0x8b, 0x82, 0x85,
    0xa8, 0xaf, 0xa6, 0xa1, 0xb4, 0xb3, 0xba, 0xbd,
    0xc7, 0xc0, 0xc9, 0xce, 0xdb, 0xdc, 0xd5, 0xd2,
    0xff, 0xf8, 0xf1, 0xf6, 0xe3, 0xe4, 0xed, 0xea,
    0xb7, 0xb0, 0xb9, 0xbe, 0xab, 0xac, 0xa5, 0xa2,
    0x8f, 0x88, 0x81, 0x86, 0x93, 0x94, 0x9d, 0x9a,
    0x27, 0x20, 0x29, 0x2e, 0x3b, 0x3c, 0x35, 0x32,
    0x1f, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0d, 0x0a,
    0x57, 0x50, 0x59, 0x5e, 0x4b, 0x4c, 0x45, 0x42,
    0x6f, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7d, 0x7a,
    0x89, 0x8e, 0x87, 0x80, 0x95, 0x92, 0x9b, 0x9c,
    0xb1, 0xb6, 0xbf, 0xb8, 0xad, 0xaa, 0xa3, 0xa4,
    0xf9, 0xfe, 0xf7, 0xf0, 0xe5, 0xe2, 0xeb, 0xec,
    0xc1, 0xc6, 0xcf, 0xc8, 0xdd, 0xda, 0xd3, 0xd4,
    0x69, 0x6e, 0x67, 0x60, 0x75, 0x72, 0x7b, 0x7c,
    0x51, 0x56, 0x5f, 0x58, 0x4d, 0x4a, 0x43, 0x44,
    0x19, 0x1e, 0x17, 0x10, 0x05, 0x02, 0x0b, 0x0c,
    0x21, 0x26, 0x2f, 0x28, 0x3d, 0x3a, 0x33, 0x34,
    0x4e, 0x49, 0x40, 0x47, 0x52, 0x55, 0x5c, 0x5b,
    0x76, 0x71, 0x78, 0x7f, 0x6a, 0x6d, 0x64, 0x63,
    0x3e, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2c, 0x2b,
    0x06, 0x01, 0x08, 0x0f, 0x1a, 0x1d, 0x14, 0x13,
    0xae, 0xa9, 0xa0, 0xa7, 0xb2, 0xb5, 0xbc, 0xbb,
    0x96, 0x91, 0x98, 0x9f, 0x8a, 0x8d, 0x84, 0x83,
    0xde, 0xd9, 0xd0, 0xd7, 0xc2, 0xc5, 0xcc, 0xcb,
    0xe6, 0xe1, 0xe8, 0xef, 0xfa, 0xfd, 0xf4, 0xf3
]
# fmt: on

_IS_LEAF = 0x80
_INCLUDE_SUBDOMAINS = 0x40


try:
    from importlib.resources import open_binary

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open_binary("hstspreload", path)


except ImportError:

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open(
            os.path.join(os.path.dirname(os.path.abspath(__file__)), path),
            "rb",
        )


@functools.lru_cache(maxsize=1024)
def in_hsts_preload(host: typing.AnyStr) -> bool:
    """Determines if an IDNA-encoded host is on the HSTS preload list"""

    if isinstance(host, str):
        host = host.encode("ascii")
    labels = host.lower().split(b".")

    # Fast-branch for gTLDs that are registered to preload all sub-domains.
    if labels[-1] in _GTLD_INCLUDE_SUBDOMAINS:
        return True

    with open_pkg_binary("hstspreload.bin") as f:
        for layer, label in enumerate(labels[::-1]):
            # None of our layers are greater than 5 deep.
            if layer > 4:
                return False

            # Read the jump table for the layer and label
            jump_info = _JUMPTABLE[layer][_crc8(label)]
            if jump_info is None:
                # No entry: host is not preloaded
                return False

            # Read the set of entries for that layer and label
            f.seek(jump_info[0])
            data = bytearray(jump_info[1])
            f.readinto(data)

            for is_leaf, include_subdomains, ent_label in _iter_entries(data):
                # We found a potential leaf
                if is_leaf:
                    if ent_label == host:
                        return True
                    if include_subdomains and host.endswith(b"." + ent_label):
                        return True

                # Continue traversing as we're not at a leaf.
                elif label == ent_label:
                    break
            else:
                return False
    return False


def _iter_entries(data: bytes) -> typing.Iterable[typing.Tuple[int, int, bytes]]:
    while data:
        flags = data[0]
        size = data[1]
        label = bytes(data[2 : 2 + size])
        yield (flags & _IS_LEAF, flags & _INCLUDE_SUBDOMAINS, label)
        data = data[2 + size :]


def _crc8(value: bytes) -> int:
    # CRC8 reference implementation: https://github.com/niccokunzmann/crc8
    checksum = 0x00
    for byte in value:
        checksum = _CRC8_TABLE[checksum ^ byte]
    return checksum
